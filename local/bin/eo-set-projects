#!/bin/bash
# script to create links and fix shared space permissions
PROJHOME=/nfs/sloanlab001/projects

#make sure projects space and links exist, if not, create
[ ! -d $HOME/projects ] && mkdir $HOME/projects
grplist=`groups | grep _proj`
if [[ $? -ne 0 ]]; then
  echo ""
  echo "No shared project folder(s) found. If this is an error or you want to setup a"
  echo "shared project space, please contact stshelp@mit.edu"
  echo ""
  exit 1
fi
for gr in `echo $grplist`; do
  if [[ $gr =~ .*_proj && -d $PROJHOME/$gr ]]; then
    [ ! -L $HOME/projects/$gr ] && ln -s $PROJHOME/$gr $HOME/projects/$gr
    find $PROJHOME/$gr -user $USER -exec chgrp $gr {} \;
    find $PROJHOME/$gr -user $USER -type f -exec chmod g+w {} \;
    find $PROJHOME/$gr -user $USER -type d -exec chmod g+ws {} \;
  fi
done

echo""
echo 'Links to shared folders created in the "projects" directory of your home'
echo ""
echo "File and folder permissions fixed on files owned by you.  To"
echo "ensure all files are correct please ask your project colleagues"
echo "to run the eo-set-projects command"
echo""

exit 0

