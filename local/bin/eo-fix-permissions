#!/bin/bash
# script fix shared space permissions
PROJHOME=/nfs/sloanlab001/projects

#make sure projects space and links exist, if not, create
grplist=`groups | grep _proj`
for gr in `echo $grplist`; do
  if [[ $gr =~ .*_proj && -d $PROJHOME/$gr ]]; then
    find -L $PROJHOME/$gr -user $USER -exec chgrp $gr {} \;
    find -L $PROJHOME/$gr -user $USER -type f -exec chmod ug+rw {} \;
    find -L $PROJHOME/$gr -user $USER -type d -exec chmod ug+rws {} \;
    echo "File permissions fixed in shared project $PROJHOME/$gr"
  fi
done
#fix pool
chmod -f 700 /pool001/$USER
echo "File permissions fixed in /pool001/$USER"
#fix lustre
chmod -f 700 /nobackup1/$USER
echo "File permissions fixed in /nobackup1/$USER"


echo""
echo "If you have shared project spaces, please make sure all members of your"
echo "project group also run eo-fix-permissions to assure everyone in the "
echo "project group has access"
echo""

exit 0

